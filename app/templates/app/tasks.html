{% extends 'app/layout.html' %}
{% load humanize %}
{% load static %}

{% block extra_head %}
<link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.1/main.min.css' rel='stylesheet' />
<script src="
https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.15/index.global.min.js
"></script>
<style>
    #calendar {
        height: 600px; /* Adjust this value as needed */
        margin: 20px 0;
    }
</style>
{% endblock %}

{% block content %}
<h2>Tasks for {{ project.name }}</h2>
<a href="{% url 'create_task'  %}" class="btn btn-primary">Add Task</a>


<div id='calendar'></div>
<script>

    document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');

        const calendar = new FullCalendar.Calendar(calendarEl, {
            schedulerLicenseKey: 'YOUR_LICENSE_KEY', // Replace with your license key if needed
            initialView: 'timelineMonth',
            views: {
                resourceTimelineMonth: {
                    titleFormat: { year: 'numeric', month: 'long' }
                }
            },
            events: function (fetchInfo, successCallback, failureCallback) {
                fetch('tasks-events/') // Django URL for the task events view
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (Array.isArray(data)) {
                            successCallback(data);
                        } else {
                            console.error(' format', data);
                            throw new Error('Unexpected data format');
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching events:', error);
                        failureCallback(error);
                    });
            },
            eventClick: function (info) {
                window.location.href = `/task/${info.event.id}/`;
            },
            loading: function (isLoading) {
                if (isLoading) {
                    console.log('Calendar is loading events...');
                } else {
                    console.log('Calendar finished loading events.');
                }
            }
        });

        calendar.render();
    });
</script>

{% endblock %}
