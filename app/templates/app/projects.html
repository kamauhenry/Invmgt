{% extends 'app/layout.html' %}

{% load humanize %}

{% load static %}
{% block content %}
<head>
    <style>
        /* Apply margin to the proj class */
        .proj {
            margin-bottom: 20px; /* Space below this div */
        }

        /* Apply margin to the proj1 class */
        .proj1 {
            padding: 20px;
            background-color: #f0f0f0; /* Light grey background for visibility */
            border-bottom: 2px solid #000; /* Black border line */
            margin-bottom: 20px; /* Space below this div */
        }

        /* Apply margin to the proj2 class */
        .proj2 {
            margin-bottom: 20px; /* Space below this div */
        }

        /* Ensure space between rows in proj2 */
        .projrow {
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin-top: 30px;
        }
        .project-row {

        }
        /* Optional: Add space between project-box elements */
        .project-box {
            margin-bottom: 10px;
            width: 100%;
            height: 100%;
        }
        .btn-secondary {
            width: 120px;
            height: 150px;
        }

    </style>
</head>

<body>
    <div class="proj">
        <h1>Welcome to Project Management!</h1>
        <p15 id="greeting"></p15>

    </div>
    <div class="proj1">
        <a href="{% url 'create_project' %}" class="btn btn-primary mb-3 projbtn">Create New Project +</a>
    </div>
    <div class="proj2">
        <h2> My Projects </h2>
        <div id="projects-container" class="projrow">
            <!-- Project buttons will be dynamically inserted here -->

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const greetingEl = document.getElementById('greeting');
            const date = new Date();
            const hour = date.getHours();

            if (hour < 12) {
                greetingEl.textContent = 'Good Morning!';
            } else if (hour < 17) {
                greetingEl.textContent = 'Good Afternoon!';
            } else {
                greetingEl.textContent = 'Good Evening!';
            }

            // Function to render project buttons
            function renderProjects(projects) {
                const container = document.getElementById('projects-container');

                // Ensure container is not null
                if (container === null) {
                    console.error('Container element not found');
                    return;
                }

                // Clear existing content
                container.innerHTML = '';

                // Generate project buttons
                projects.forEach(project => {
                    const projectRow = document.createElement('div');
                    projectRow.className = 'project-row';

                    const projectBox = document.createElement('div');
                    projectBox.className = 'project-box';

                    const button = document.createElement('button');
                    button.className = 'btn-secondary';
                    button.textContent = project.name;
                    button.onclick = () => window.location.href = project.link;

                    projectBox.appendChild(button);
                    projectRow.appendChild(projectBox);
                    container.appendChild(projectRow);
                });
            }

            // Fetch project data from the Django API
            function fetchProjects() {
                const userId = "{{ request.user.id }}"; // Django template tag to get the logged-in user's ID

                fetch(`/api/projects/${userId}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken') // Include CSRF token if needed
                    },
                    credentials: 'include' // Include credentials (cookies) in the request
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Project data fetched:', data); // Debug log
                        renderProjects(data);
                    })
                    .catch(error => {
                        console.error('Error fetching project data:', error);
                    });
            }

            // Utility function to get CSRF token from cookies
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            fetchProjects(); // Call the function to fetch projects
        });
    </script>


  
</body>



{% endblock %}